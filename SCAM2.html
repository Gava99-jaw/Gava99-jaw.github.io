<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        button {
            background: white;
            color: #667eea;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px 0;
            width: 100%;
            font-weight: bold;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .hidden {
            display: none;
        }
        #walletInfo {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            word-break: break-all;
        }
        .telegram-button {
            background: #0088cc;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞</h1>
        <p>–ü—Ä–∏–≤—è–∂–∏—Ç–µ –∫—Ä–∏–ø—Ç–æ-–∫–æ—à–µ–ª–µ–∫ –∫ –≤–∞—à–µ–º—É Telegram –∞–∫–∫–∞—É–Ω—Ç—É</p>
        
        <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤ -->
        <button id="connectMetaMask" class="hidden">ü¶ä –ü–æ–¥–∫–ª—é—á–∏—Ç—å MetaMask</button>
        <button id="connectWalletConnect" class="hidden">üîó WalletConnect</button>
        <button id="connectPhantom" class="hidden">üëª Phantom (Solana)</button>
        
        <div id="telegramAuth" class="hidden">
            <button id="getTelegramData" class="telegram-button">üì± –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ Telegram</button>
            <div id="telegramData"></div>
        </div>
        
        <div id="walletInfo" class="hidden">
            <h3>‚úÖ –ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω!</h3>
            <p><strong>–ê–¥—Ä–µ—Å:</strong> <span id="walletAddress"></span></p>
            <p><strong>–ë–∞–ª–∞–Ω—Å:</strong> <span id="walletBalance"></span></p>
            <p><strong>–°–µ—Ç—å:</strong> <span id="networkInfo"></span></p>
        </div>
        
        <button id="sendToBot" class="hidden">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1/dist/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script>
        // Telegram Web App API
        const tg = window.Telegram.WebApp;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        tg.expand();
        tg.MainButton.setText("–ì–æ—Ç–æ–≤–æ").hide();
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function getTelegramUserData() {
            const user = tg.initDataUnsafe.user;
            if (user) {
                return {
                    id: user.id,
                    username: user.username,
                    firstName: user.first_name,
                    lastName: user.last_name
                };
            }
            return null;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∫–æ—à–µ–ª—å–∫–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            const telegramData = getTelegramUserData();
            if (telegramData) {
                document.getElementById('telegramData').innerHTML = `
                    <p>ID: ${telegramData.id}</p>
                    <p>–ò–º—è: ${telegramData.firstName}</p>
                    ${telegramData.username ? `<p>@${telegramData.username}</p>` : ''}
                `;
                document.getElementById('telegramAuth').classList.remove('hidden');
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏
            detectWallets();
        });
        
        function detectWallets() {
            // MetaMask
            if (typeof window.ethereum !== 'undefined') {
                document.getElementById('connectMetaMask').classList.remove('hidden');
            }
            
            // –î–ª—è –¥—Ä—É–≥–∏—Ö –∫–æ—à–µ–ª—å–∫–æ–≤ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
            document.getElementById('connectWalletConnect').classList.remove('hidden');
            document.getElementById('connectPhantom').classList.remove('hidden');
        }
        
        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ MetaMask
        document.getElementById('connectMetaMask').addEventListener('click', async () => {
            try {
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                const address = accounts[0];
                const web3 = new Web3(window.ethereum);
                
                const balance = await web3.eth.getBalance(address);
                const balanceEth = web3.utils.fromWei(balance, 'ether');
                
                const networkId = await web3.eth.net.getId();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                document.getElementById('walletAddress').textContent = 
                    `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;
                document.getElementById('walletBalance').textContent = 
                    `${parseFloat(balanceEth).toFixed(4)} ETH`;
                document.getElementById('networkInfo').textContent = 
                    getNetworkName(networkId);
                
                document.getElementById('walletInfo').classList.remove('hidden');
                document.getElementById('sendToBot').classList.remove('hidden');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                window.walletData = {
                    address: address,
                    balance: balanceEth,
                    network: networkId,
                    provider: 'MetaMask'
                };
                
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message);
            }
        });
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
        document.getElementById('sendToBot').addEventListener('click', () => {
            const telegramUser = getTelegramUserData();
            const walletData = window.walletData;
            
            if (!telegramUser || !walletData) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏');
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ –≤ –±–æ—Ç
            const data = {
                telegram: telegramUser,
                wallet: walletData,
                timestamp: Date.now()
            };
            
            // –ú–µ—Ç–æ–¥ 1: –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram Web App
            tg.sendData(JSON.stringify(data));
            
            // –ú–µ—Ç–æ–¥ 2: –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å MainButton –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            tg.MainButton.setText("‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ")
                .onClick(() => {
                    tg.sendData(JSON.stringify(data));
                    tg.close();
                })
                .show();
        });
        
        function getNetworkName(networkId) {
            const networks = {
                1: 'Ethereum Mainnet',
                3: 'Ropsten',
                4: 'Rinkeby',
                5: 'Goerli',
                56: 'BNB Smart Chain',
                137: 'Polygon',
                42161: 'Arbitrum',
                10: 'Optimism'
            };
            return networks[networkId] || `–°–µ—Ç—å #${networkId}`;
        }
        
        // WalletConnect –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)
        document.getElementById('connectWalletConnect').addEventListener('click', () => {
            alert('–î–ª—è WalletConnect –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å –ø—Ä–æ–µ–∫—Ç–æ–º –Ω–∞ walletconnect.com');
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ WalletConnect —Ç—Ä–µ–±—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
        });
        
        // Phantom Wallet –¥–ª—è Solana
        document.getElementById('connectPhantom').addEventListener('click', async () => {
            if (window.solana && window.solana.isPhantom) {
                try {
                    const resp = await window.solana.connect();
                    const address = resp.publicKey.toString();
                    
                    // –î–ª—è Solana –Ω—É–∂–µ–Ω –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥
                    alert(`Phantom –ø–æ–¥–∫–ª—é—á–µ–Ω! –ê–¥—Ä–µ—Å: ${address.substring(0, 6)}...`);
                    
                    window.walletData = {
                        address: address,
                        provider: 'Phantom',
                        blockchain: 'Solana'
                    };
                    
                    document.getElementById('sendToBot').classList.remove('hidden');
                    
                } catch (err) {
                    alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Phantom: ' + err.message);
                }
            } else {
                alert('–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Phantom Wallet –¥–ª—è Solana');
                window.open('https://phantom.app/', '_blank');
            }
        });
    </script>
</body>
</html>